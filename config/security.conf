# Apache security headers for WordPress
# This file should be included in the Dockerfile

# Prevent clickjacking
Header always set X-Frame-Options "SAMEORIGIN"

# Prevent MIME type sniffing
Header always set X-Content-Type-Options "nosniff"

# Enable XSS protection
Header always set X-XSS-Protection "1; mode=block"

# Referrer policy
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# Content Security Policy
# More permissive for WordPress admin to support Gutenberg editor
<If "%{REQUEST_URI} =~ m#^/wp-admin/.*#">
    Header always set Content-Security-Policy "default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; frame-ancestors 'self';"
</If>
<Else>
    Header always set Content-Security-Policy "default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'; frame-ancestors 'self';"
</Else>

# Hide Apache version
ServerTokens Prod
ServerSignature Off

# Disable directory browsing
Options -Indexes

# Protect sensitive files
<FilesMatch "^(wp-config\.php|\.htaccess|\.htpasswd|\.svn|\.git)">
    Require all denied
</FilesMatch>

# Block access to PHP files in uploads
<Directory "/var/www/html/wp-content/uploads">
    <FilesMatch "\.php$">
        Require all denied
    </FilesMatch>
</Directory>

# Limit file uploads to 64MB (matching PHP config)
LimitRequestBody 67108864

# Protect against SQL injection in query strings
<IfModule mod_rewrite.c>
    RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
    RewriteRule .* - [F,L]
</IfModule>